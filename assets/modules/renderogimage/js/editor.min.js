"use strict";const application=function(t){let e,n,i=0,l={images:[],defaultImages:[],text:null,filterLayer:[]},a=null,o=t.bgcolor,s=t.fontfamily,r=t.fontweight,u=t.linewidth;function f(t){let e;if(e=document.querySelector(t))return e;throw"Невыбран элемент: "+t}function c(){let n=[],i=[];n.txt=f(".post_text").value="Текст и лого\nможно двигать",n.x=0,n.y=e.height/2-75,n.pressX=0,n.pressY=0,o=f(".input_select_bgcolor").value=o||"#000000",n.fontfamily=f(".input_select_font_family").value=s=t.fontfamily||"Calibri",n.fontweight=f(".input_select_fontweight").value=r=t.fontweight||"normal",n.linewidth=f(".input_select_linewidth").value=u=t.linewidth||"4",n.fonsize=f(".input_fontsize").value="48",n.textoutline=f(".input_select_textoutline").value="#000000",n.textcolor=f(".input_select_textcolor").value="#FFFFFF",i.alpha=f(".input_overlay_alpha").value="0.2",i.color=o,l.images=[],l.text=n,l.filterLayer=i}function h(t){let e=1144/t.width;e<1?n.drawImage(t.image,t.x,t.y,t.width*e,t.height*e):n.drawImage(t.image,t.x,t.y,t.width,t.height)}function d(){n.fillStyle=o,n.fillRect(0,0,1144,643),l.images.length>0&&l.images.forEach(t=>{h(t)}),n.fillStyle=l.filterLayer.color,n.globalAlpha=l.filterLayer.alpha,n.fillRect(0,0,1144,643),n.globalAlpha=1,l.text&&function(t){let e=function(t,e){let n=t.split(/\r\n|\n/g),i=[];n[0];for(var l=0;l<n.length;l++)n[l],i.push(n[l]);return i}(t.txt),i=0,a=t.y,o=[],s=[],r=0;e.forEach(e=>{n.font=t.fontweight+" "+t.fonsize+"px "+t.fontfamily,i+=1.2*parseInt(t.fonsize),n.textAlign="left",n.fillStyle=t.textcolor;let l=parseInt(n.measureText(e).width),u=572-l/2;r+=i,o.push(parseInt(u)),s.push(572+l/2),n.lineWidth=t.linewidth,n.miterLimit=3,n.lineJoin="circle",n.strokeStyle=t.textoutline,n.strokeText(e,u,a+i),n.lineWidth=0,n.fillText(e,u,a+i)});let u=o.sort(function(t,e){return t-e}),f=s.sort(function(t,e){return t-e});l.text.x=u[0],l.text.width=f[0],l.text.height=r}(l.text),l.defaultImages.length>0&&l.defaultImages.forEach(t=>{h(t)})}function p(t){let e=event.layerX,n=event.layerY,i=t.x,l=t.y,a=t.x+t.width,o=t.y+t.height;return e>=i&&e<=a&&n>=l&&n<=o}function g(){n.clearRect(0,0,1144,643),e.onmousemove=function(t){a&&(a.x=t.layerX-a.pressX,a.y=t.layerY-a.pressY)},d(),requestAnimationFrame(g)}this.start=function(){(e=f(t.canvas)).width=t.width||1144,e.height=t.height||509,n=e.getContext("2d"),f(".image_src_input").addEventListener("change",function(t){if(t.target.files.length>0){let e=window.webkitURL||window.URL,n=new Image;n.src=e.createObjectURL(t.target.files[0]);let i=[];i.image=n,i.x=0,i.y=0,i.pressX=0,i.pressY=0,n.onload=function(){i.width=n.width,i.height=n.height,l.images[0]=i;try{t.target.value=null}catch(t){}t.target.value&&t.target.parentNode.replaceChild(t.target.cloneNode(!0),t.target)}}}),f(".btn_loadimage").addEventListener("click",function(){f(".image_src_input").click()}),f(".input_select_bgcolor").addEventListener("input",function(t){o=this.value}),f(".post_text").addEventListener("input",function(){l.text.txt=this.value}),f(".input_select_textcolor").addEventListener("input",function(){l.text.textcolor=this.value}),f(".input_select_textoutline").addEventListener("input",function(){l.text.textoutline=this.value}),f(".input_select_linewidth").addEventListener("input",function(){l.text.linewidth=this.value}),f(".input_fontsize").addEventListener("change",function(){l.text.fonsize=this.value}),f(".input_overlay_alpha").addEventListener("input",function(){l.filterLayer.alpha=this.value}),f(".input_select_fontweight").addEventListener("input",function(){l.text.fontweight=this.value}),f(".input_select_font_family").addEventListener("input",function(){l.text.fontfamily=this.value}),t.fonts.length>0&&t.fonts.forEach(t=>{new FontFace(t.name,t.url,{style:t.style,weight:t.weight}).load().then(function(e){let n;document.fonts.add(e),![...f(".input_select_font_family").querySelectorAll("option")].find(e=>e.value==t.name)&&((n=document.createElement("option")).textContent=n.value=t.name,f(".input_select_font_family").append(n),f(".input_select_font_family").value=s)})}),c(),g(),e.onmouseup=function(){a=null},e.onmousedown=function(t){l.images.forEach(e=>{p(e)&&((a=e).pressX=t.offsetX-e.x,a.pressY=t.offsetY-e.y)}),l.defaultImages.forEach(e=>{p(e)&&((a=e).pressX=t.offsetX-e.x,a.pressY=t.offsetY-e.y)}),p(l.text)&&((a=l.text).pressX=t.offsetX-l.text.x,a.pressY=t.offsetY-l.text.y)}},f(".download").addEventListener("click",function(t){let n=("0000"+ ++i).slice(-4),l=e.toDataURL("image/jpeg"),a=document.createElement("a");a.href=l,a.download="poster-"+n+".jpg",a.target="_blank",a.click(),a.remove()}),f(".reset").addEventListener("click",c)};